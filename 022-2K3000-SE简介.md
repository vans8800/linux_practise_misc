# 背景图片

<img width="800" height="411" alt="image" src="https://github.com/user-attachments/assets/b7b49565-7f4a-4f4d-8d07-90d44d4c70fe" />


一个围绕​​龙芯安全引擎（Loongson Security Engine, SE）​​ 构建的密码系统分层架构。设计遵循了模块化和接口标准化的原则，从底层的硬件固件到上层的应用服务接口逐层抽象。

##​ ​分层解析：​​
----

1. ​​密码设备层 (Cryptographic Device Layer)​​ /ˌkriptə'ɡræfik/

• 核心组件：龙芯SE固件 (Loongson SE Firmware)​​

• ​​功能：​​ 这是整个架构的硬件基础和安全根基。龙芯SE是一个物理的密码芯片（或集成在CPU中的安全模块），其固件是运行在该硬件上的底层软件。
   
   >它直接控制硬件，执行最核心的密码运算（如SM4加密、SM3哈希、随机数生成）和安全存储（如密钥管理）。

• ​​位置：​​ 最底层，直接与硬件交互。

2. ​​内核层 (Kernel Layer)​​

• 核心组件：龙芯SE驱动 (Loongson SE Driver)​​

• ​​功能：​​
 
> 这一层是操作系统内核的一部分。龙芯SE驱动负责：
>
> 与底层的龙芯SE固件进行通信和控制。
>
> 向上层（密码接口层）提供标准的内核接口（如字符设备、平台设备等）。
>
> 管理硬件资源（如中断、内存映射）。

• 关键细节：​​ “DSDT表需要传递LOON0011节点” - 这表明该驱动依赖于ACPI（高级配置与电源接口）表中的信息来识别和初始化龙芯SE硬件。

 > LOON0011 很可能是龙芯SE设备在ACPI DSDT（Differentiated System Description Table）中定义的特定硬件标识符（HID）。驱动需要正确解析这个节点才能找到并操作硬件。

 > LOON0011相当于一个设备节点，内核接收到这个节点信息，会调用SE驱动初始化程序

•​​位置：​​ 位于密码设备层之上，属于操作系统内核空间。

3. 密码接口层 (Cryptographic Interface Layer)​​

• ​​核心组件：​​

• SDF (Security Device Interface Framework):​​ 中国国家密码管理局制定的《安全设备应用接口规范》。它定义了一套标准的API，用于访问密码设备（如SE、密码卡、USBKey等）。应用通过调用SDF接口，可以无需关心底层具体硬件差异，实现加解密、签名验签、密钥管理等操作。

• ​​TPM2-TSS (Trusted Platform Module 2 - Software Stack):​​ TPM工作组制定的标准软件栈。它提供了访问符合TPM 2.0标准的硬件安全模块（如龙芯SE，如果它实现了TPM 2.0功能）的标准化接口和工具。TSS使得应用可以利用TPM提供的安全功能（如平台完整性度量、安全密钥存储、远程证明等）。

• ​​crypto(socket):​​ 这很可能指代​​内核的密码学API套接字接口 (AF_ALG)​​。

> 这是一种Linux内核提供的机制，允许用户空间应用程序通过标准的套接字（socket）接口访问内核内置的密码算法（包括软件实现和硬件加速实现）。
>
> sm4, sm3, rng 列在旁边，表明通过这个接口可以访问国密SM4、SM3算法以及随机数生成器（RNG）功能。

• ​​sm4, sm3, rng：​​

> sm4: 中国国家密码管理局制定的分组密码算法（对称加密），用于数据加密。
>
> sm3: 中国国家密码管理局制定的密码杂凑算法（哈希算法），用于生成数据摘要。
>
> rng: Random Number Generator (随机数生成器)，是密码学操作（如密钥生成）的基础。

• ​​功能：​​ 关键的中介层提供​​多种标准化或通用的接口​​（SDF, TPM2-TSS, AF_ALG），将底层内核驱动提供的硬件能力抽象化、标准化，并暴露给上层的密码服务层。不同的接口服务于不同的应用场景和标准要求。

•​​位置：​​ 位于内核层之上，属于操作系统用户空间，为上层应用提供调用入口。

4. ​​密码服务层 (Cryptographic Service Layer)​​

• ​​核心功能：​​

• ​​加/解密 (Encryption/Decryption):​​ 提供数据加密和解密服务，可能基于对称算法（如SM4）或非对称算法。

• 签名/验签 (Signing/Verification):​​ 提供数字签名生成（使用私钥）和签名验证（使用公钥）服务，用于身份认证和完整性保护。

• ​​国密SSL (GMSSL):​​ 指支持中国国家密码管理局（GM/T）系列密码算法（如SM2, SM3, SM4）的SSL/TLS协议实现。它提供安全的网络通信通道。

• ​​功能：​​ 这是最接近应用的一层。它基于密码接口层提供的各种基础能力，构建了​​面向具体业务需求的高层密码服务​​。

> 这些服务通常以库（如OpenSSL GM分支、国密SSL库）或API的形式提供给最终的业务应用程序调用。应用开发者主要与这一层交互来实现密码功能。

• ​​位置：​​ 最上层，直接服务于应用程序。
​​
## 数据流向：​​
---

图中的箭头表示数据（或指令/请求）的流向：

1. 应用请求（如“加密这段数据”）从​​密码服务层​​发起。

2. 请求被传递到​​密码接口层​​。根据请求的类型（如调用SDF接口或使用crypto(socket)），选择合适的接口。

3.密码接口层的调用进一步被传递到​​内核层​​的龙芯SE驱动。

4. 内核驱动最终将操作指令发送给​​密码设备层​​的龙芯SE固件执行。

5. 执行结果（如加密后的数据、签名结果）沿原路径逐层返回给应用。

## ​​英文术语解释汇总：​​
---

• ​​SDF:​​ Security Device Interface Framework (安全设备应用接口规范) - 中国制定的密码设备通用访问标准。

• TPM2-TSS:​​ Trusted Platform Module 2 - Software Stack (可信平台模块2 - 软件栈) - 访问TPM 2.0硬件的标准软件接口。

• ​​crypto:​​ Cryptography (密码学) - 泛指与信息安全相关的数学技术和算法。crypto(socket) 特指Linux内核的密码学套接字接口 (AF_ALG)。

• ​​sm4:​​ 中国国家密码管理局制定的对称分组密码算法。

• ​​sm3:​​ 中国国家密码管理局制定的密码杂凑算法（哈希算法）。

• ​​rng:​​ Random Number Generator (随机数生成器) - 产生密码学安全随机数的组件。

• ​​SE:​​ Security Engine (安全引擎) - 指龙芯芯片中集成的硬件密码模块。

• ​​Firmware:​​ 固件 - 写入硬件设备的永久性软件，控制硬件的基本功能。

• ​​Driver:​​ 驱动程序 - 操作系统用来控制特定硬件的软件模块。

• ​​DSDT:​​ Differentiated System Description Table (差异化系统描述表) - ACPI规范的一部分，描述系统硬件配置信息。

• ​​ACPI:​​ Advanced Configuration and Power Interface (高级配置与电源接口) - 操作系统用来发现和配置硬件的开放标准。

• SSL:​​ Secure Sockets Layer (安全套接字层) - 现已被TLS取代，但常作为泛指，指提供安全通信的协议。国密SSL指支持国密算法的SSL/TLS实现。

• ​​Encryption/Decryption:​​ 加密/解密。

• ​​Signing/Verification:​​ 签名/验签。

## ​​总结
---
​​
龙芯安全引擎从硬件到应用服务的完整软件栈通过分层设计（设备->内核->接口->服务）实现了硬件能力的抽象、标准化和易用性。

密码接口层提供了多种访问方式（SDF, TPM2-TSS, AF_ALG），以满足不同应用场景和标准的要求。

最终，密码服务层将这些基础能力封装成应用可直接调用的高级密码功能（加解密、签名验签、国密SSL）。
